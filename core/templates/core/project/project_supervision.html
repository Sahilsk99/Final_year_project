{% extends "core/logged_base.html" %}

{% block content %}
{% if user.is_authenticated %}
{% if user.is_supervisor %}
<div class="breadcrumbs">
    <a href="{% url "home" %}">SPMS</a>
    &rsaquo;
    Supervisor
    &rsaquo;
    <a href="{% url "project" %}">Project</a>
    &rsaquo;
    <a class="current" href="{% url "project" %}">Project Supervision</a>
    <span class="float-right">Logged in as Supervisor</span>
</div>
<div class="wrapper">
    <div class="row milestone mt-3 mb-3 bg-dark text-light">
        <div class="col-md-2 text-left pl-1">Semester1</div>
        <div class="col-md-1 text-left pl-1">Status</div>
        <div class="col-md-1 text-left pl-1">Start Date</div>
        <div class="col-md-1 text-left pl-1">End Date</div>
        <div class="col-md-2 text-left pl-1">Remaining Days</div>
        <div class="col-md-2 text-left pl-1">Document Title</div>
        <div class="col-md-2 text-left pl-1">Download Documentation</div>
        <div class="col-md-1 text-left pl-1">Comments</div>
    </div>
    {% for milestone in milestones %}
    <script>
        window.onload = function activateModals(){
                var id2 = "milestone_"+"{{ milestone.id }}";
                document.getElementById("comment-id").setAttribute("id",id2);
                document.getElementById("comment-modal").setAttribute("data-target", "#"+id2);
    
                console.log(id2);
                // }
                console.log("success");
            }
        </script>
    <div class="row milestone mt-1">
        <div class="col-md-2 text-left pl-1"><a href=""></a>{{ milestone.milestone_name }}
            <input type="hidden" id="myVar" name="variable" value="{{ milestone.id }}">
        </div>
        <div class="col-md-1 text-left pl-1">
            {% if milestone.status == "NS" %}Not Started
            {% elif milestone.status == "ON" %}Ongoing
            {% else %} Finished
            {% endif %}
        </div>
        <div class="col-md-1 text-left pl-1">
            {{ milestone.start_date }}
        </div>
        <div class="col-md-1 text-left pl-1">{{ milestone.end_date}}</div>
        <div class="col-md-2 text-left pl-1">
            {% for key,values in remaining_days.items %}
            {% if key == milestone.id %}
            {{ values }}
            {% endif %}
            {% endfor %}
        </div>
        <div class="col-md-2 text-left pl-1">Submit Documentation</div>
        <div class="col-md-2 text-left pl-1">
            <a href="" data-toggle="modal" id="modal-link" data-target="#{{ milestone.id }}">Download</a>
            <div class="modal" id="{{ milestone.id }}">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Download Documents for {{ milestone.milestone_name }}</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <table class="table">
                                <th>Document Title</th>
                                <th>Link</th>
                                {% for document in documents %}
                                {% if document.student_id == student.id %}
                                {% if document.milestone_id == milestone.id %}
                                <tr>
                                    <td>{{ document.title }}</td>
                                    <td><a href="{% url "download" document.id %}">Download</a></td>
                                </tr>
                                <tr>
                                </tr>
                                {% endif %}
                                {% endif %}
                                {% endfor %}
                            </table>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-1 text-left pl-1">
            <div class="col-md-1 text-left pl-1">
                <div class="modal" id="comment-id">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">View Comments on {{ milestone.milestone_name }}</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <table id="comments">
                                    {% for comment in comments %}
                                    <tr>
                                        {% if comment.sender == 0 %}
                                        <td class="comment">
                                            By {{ comment.supervisor.first_name}} - {{ comment.sent_date }} </br>
                                            {{ comment.text }}
                                        </td>
                                        <td>

                                        </td>
                                        {% else %}
                                        <td>

                                        </td>
                                        <td class="comment">
                                            By {{ comment.student.first_name}} - {{ comment.sent_date }} </br>
                                            {{ comment.text }}
                                        </td>
                                        {% endif %}
                                    </tr>
                                    {% endfor %}
                                </table>
                                <form method="POST" action="{% url "view_comments" milestone.id student.id %}">
                                    {% csrf_token %}
                                    {{ form }}
                                    <button class="btn btn-success" type="submit">Send</button>
                                </form>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="" id="comment-modal" data-toggle="modal" data-target="#comment-id">Comments</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
{% endif %}
{% endif %}
{% endblock %}